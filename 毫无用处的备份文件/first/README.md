# 训练模块 (train)

## 模块说明
训练模块负责模型训练的核心功能，包括数据加载、模型创建、训练循环、验证评估等。

## 文件说明

### main.py
**作用**: 主训练程序，项目训练入口文件
- 协调整个训练流程
- 模型训练、验证和评估
- 支持GPU/CPU训练
- 早停、学习率调度等优化策略

**主要功能**:
- `StockTrainer`类：负责模型训练和评估
- `load_data()`: 加载和处理训练数据
- `create_model()`: 创建Transformer模型
- `train()`: 训练模型
- `evaluate()`: 评估模型性能

**使用方法**:
```bash
cd learn/train
python main.py
```

## 训练流程

### 1. 数据加载
- 从data板块加载处理好的数据
- 数据标准化和序列化
- 划分训练集和验证集

### 2. 模型创建
- 根据配置创建Transformer模型
- 初始化模型参数
- 设置优化器和损失函数

### 3. 训练循环
- 执行训练和验证
- 早停机制防止过拟合
- 学习率调度优化训练
- 模型保存和恢复

### 4. 性能评估
- 计算各种评估指标
- 生成训练曲线
- 保存最佳模型

## 配置参数

主要配置参数在 `main.py` 中设置：

```python
config = {
    'seq_length': 30,        # 序列长度
    'input_dim': 21,         # 输入特征维度
    'd_model': 96,           # 模型维度
    'nhead': 8,              # 注意力头数
    'num_layers': 3,         # Transformer层数
    'batch_size': 16,        # 批次大小
    'learning_rate': 0.001,  # 学习率
    'epochs': 50,            # 训练轮数
    'patience': 15,          # 早停耐心值
    'model_type': 'basic',   # 模型类型
    'target_col': 'close',   # 预测目标
    'stock_codes': None      # 股票代码（None表示全部）
}
```

## 输出结果

- **模型文件**: 保存在 `../models/` 目录
- **训练曲线**: 保存在 `../results/training_curves.png`
- **日志文件**: 保存在 `../logs/` 目录
- **训练报告**: 包含训练统计和性能指标

## 训练优化

### 早停机制
- 监控验证损失
- 自动停止过拟合
- 保存最佳模型

### 学习率调度
- 动态调整学习率
- 提高训练效率
- 避免局部最优

### 梯度裁剪
- 防止梯度爆炸
- 稳定训练过程
- 提高收敛速度 